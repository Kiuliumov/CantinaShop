{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="bg-gray-900 text-white min-h-screen flex flex-col items-center py-12 px-4">
  <h1 class="text-4xl font-extrabold mb-8 flex items-center space-x-3">
    <span>Admin Chat Room</span>
    <i class="fas fa-comments text-indigo-400"></i>
  </h1>

  <div id="chat-box" class="w-full max-w-3xl flex flex-col bg-gray-800 rounded-lg shadow-lg overflow-hidden">
    <div id="messages" class="flex-grow overflow-y-auto p-6 space-y-4 scrollbar-thin scrollbar-thumb-indigo-500 scrollbar-track-gray-700" style="max-height: 500px;">
    </div>

    <form id="chat-form" class="flex border-t border-gray-700 bg-gray-900 p-4">
      <input id="chat-input" type="text" autocomplete="off" placeholder="Type your message..." class="flex-grow bg-gray-700 rounded-md px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
      <button type="submit" id="send-btn" class="ml-4 bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-md font-semibold transition">
        Send
      </button>
    </form>
  </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" crossorigin="anonymous"></script>
<script>
  const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
  const chatSocket = new WebSocket(`${wsProtocol}://${window.location.host}/ws/chat/`);

  const messages = document.getElementById('messages');
  const form = document.getElementById('chat-form');
  const input = document.getElementById('chat-input');

  function appendMessage(text, isAdmin) {
    const div = document.createElement('div');
    div.classList.add('max-w-xs', 'px-4', 'py-2', 'rounded-lg', 'break-words');
    div.classList.add(isAdmin ? 'bg-indigo-600' : 'bg-gray-700');
    div.classList.add(isAdmin ? 'ml-auto' : 'mr-auto');
    div.classList.add(isAdmin ? 'text-white' : 'text-gray-300');
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  chatSocket.onopen = () => {
    console.log("WebSocket connected.");
  };

  chatSocket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    appendMessage(`${data.username}: ${data.message}`, data.is_admin);
  };

  chatSocket.onclose = () => {
    console.error("WebSocket closed.");
  };

  form.addEventListener('submit', e => {
    e.preventDefault();
    const msg = input.value.trim();
    if (!msg) return;
    chatSocket.send(JSON.stringify({
      message: msg,
      is_admin: true,
      username: "Admin"
    }));
    input.value = '';
  });
</script>
{% endblock %}
